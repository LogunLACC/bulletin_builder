{% extends "base.html" %}

{% block content %}
    <div class="header">
        <h1>{{ settings.bulletin_title or 'Weekly Bulletin' }}</h1>
        {% if settings.bulletin_date %}
        <p>{{ settings.bulletin_date }}</p>
        {% endif %}
    </div>

    {% if sections %}
    <ul class="toc">
        {% for section in sections %}
            {% if section.title %}
            {% set section_id = section.title|lower|replace(' ', '-')|replace('.', '')|replace(',', '')|replace('!', '')|replace('?', '') %}
            <li><a href="#{{ section_id }}">{{ section.title }}</a></li>
            {% endif %}
        {% endfor %}
    </ul>
    {% endif %}

    {% for section in sections %}
        {% if section.title %}
            {% set section_id = section.title|lower|replace(' ', '-')|replace('.', '')|replace(',', '')|replace('!', '')|replace('?', '') %}
            <section id="{{ section_id }}" class="section">
                <h2 id="{{ section_id }}-h2">{{ section.title }}</h2>
        {% else %}
            <section class="section">
        {% endif %}
            {# Intelligently choose the correct template #}
            {% if 'events' in section.type %}
                {# If the type contains 'events', use the master events partial #}
                {% include 'partials/events.html' with context %}
            {% elif section.type %}
                {# Otherwise, use the specific partial for that type #}
                {% include ['partials/' ~ section.type ~ '.html', 'partials/default.html'] ignore missing with context %}
            {% endif %}
            </section>
    {% endfor %}
{% endblock %}